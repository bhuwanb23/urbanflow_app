<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UrbanFlow Database Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            padding: 10px;
        }

        .tab {
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: transparent;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .content {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #667eea;
            color: white;
            margin: 5px;
        }

        .btn:hover {
            background: #5a67d8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-database"></i> UrbanFlow Database Dashboard</h1>
            <p>Real-time database monitoring</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">Overview</button>
            <button class="tab" onclick="showTab('users')">Users</button>
            <button class="tab" onclick="showTab('trips')">Trips</button>
            <button class="tab" onclick="showTab('routes')">Routes</button>
            <button class="tab" onclick="showTab('ecostats')">Eco Stats</button>
            <button class="tab" onclick="showTab('notifications')">Notifications</button>
            <button class="tab" onclick="showTab('traffic')">Traffic</button>
        </div>

        <div class="content">
            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <h2><i class="fas fa-chart-pie"></i> Database Overview</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="userCount">--</div>
                        <div class="stat-label">Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="tripCount">--</div>
                        <div class="stat-label">Trips</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="routeCount">--</div>
                        <div class="stat-label">Routes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="notificationCount">--</div>
                        <div class="stat-label">Notifications</div>
                    </div>
                </div>
                <button class="btn" onclick="loadOverview()">Refresh</button>
                <div id="overviewData"></div>
            </div>

            <!-- Users Tab -->
            <div id="users" class="tab-content">
                <h2><i class="fas fa-users"></i> Users</h2>
                <button class="btn" onclick="loadUsers()">Refresh</button>
                <div id="usersData">
                    <div class="loading">Loading users...</div>
                </div>
            </div>

            <!-- Trips Tab -->
            <div id="trips" class="tab-content">
                <h2><i class="fas fa-route"></i> Trips</h2>
                <button class="btn" onclick="loadTrips()">Refresh</button>
                <div id="tripsData">
                    <div class="loading">Loading trips...</div>
                </div>
            </div>

            <!-- Routes Tab -->
            <div id="routes" class="tab-content">
                <h2><i class="fas fa-map"></i> Routes</h2>
                <button class="btn" onclick="loadRoutes()">Refresh</button>
                <div id="routesData">
                    <div class="loading">Loading routes...</div>
                </div>
            </div>

            <!-- Eco Stats Tab -->
            <div id="ecostats" class="tab-content">
                <h2><i class="fas fa-leaf"></i> Eco Stats</h2>
                <button class="btn" onclick="loadEcoStats()">Refresh</button>
                <div id="ecoStatsData">
                    <div class="loading">Loading eco stats...</div>
                </div>
            </div>

            <!-- Notifications Tab -->
            <div id="notifications" class="tab-content">
                <h2><i class="fas fa-bell"></i> Notifications</h2>
                <button class="btn" onclick="loadNotifications()">Refresh</button>
                <div id="notificationsData">
                    <div class="loading">Loading notifications...</div>
                </div>
            </div>

            <!-- Traffic Tab -->
            <div id="traffic" class="tab-content">
                <h2><i class="fas fa-car"></i> Live Traffic</h2>
                <button class="btn" onclick="loadTraffic()">Refresh</button>
                <div id="trafficData">
                    <div class="loading">Loading traffic data...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Load data
            loadTabData(tabName);
        }

        function loadTabData(tabName) {
            switch(tabName) {
                case 'overview': loadOverview(); break;
                case 'users': loadUsers(); break;
                case 'trips': loadTrips(); break;
                case 'routes': loadRoutes(); break;
                case 'ecostats': loadEcoStats(); break;
                case 'notifications': loadNotifications(); break;
                case 'traffic': loadTraffic(); break;
            }
        }

        // API functions
        async function fetchData(endpoint) {
            try {
                const response = await fetch(`/api/v1/${endpoint}`);
                return await response.json();
            } catch (error) {
                console.error('Error:', error);
                return null;
            }
        }

        // Load functions
        async function loadOverview() {
            document.getElementById('overviewData').innerHTML = '<div class="loading">Loading overview...</div>';
            
            try {
                // Fetch all data to get counts
                const [users, trips, routes, ecoStats, notifications, traffic] = await Promise.all([
                    fetchData('user'),
                    fetchData('trips'),
                    fetchData('routes'),
                    fetchData('ecostats'),
                    fetchData('notifications'),
                    fetchData('traffic')
                ]);

                const userCount = users?.data?.length || 0;
                const tripCount = trips?.data?.length || 0;
                const routeCount = routes?.data?.length || 0;
                const notificationCount = notifications?.data?.length || 0;
                const ecoStatsCount = ecoStats?.data?.length || 0;
                const trafficCount = traffic?.data?.length || 0;

                // Update stats cards
                document.getElementById('userCount').textContent = userCount;
                document.getElementById('tripCount').textContent = tripCount;
                document.getElementById('routeCount').textContent = routeCount;
                document.getElementById('notificationCount').textContent = notificationCount;
                
                document.getElementById('overviewData').innerHTML = `
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px;">
                        <h3>Database Status</h3>
                        <p>Total Users: ${userCount}</p>
                        <p>Total Trips: ${tripCount}</p>
                        <p>Total Routes: ${routeCount}</p>
                        <p>Total Notifications: ${notificationCount}</p>
                        <p>Total Eco Stats: ${ecoStatsCount}</p>
                        <p>Total Traffic Records: ${trafficCount}</p>
                        <p>Last Updated: ${new Date().toLocaleString()}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('overviewData').innerHTML = '<div class="error">Error loading overview</div>';
            }
        }

        async function loadUsers() {
            const container = document.getElementById('usersData');
            container.innerHTML = '<div class="loading">Loading users...</div>';
            
            try {
                const data = await fetchData('user');
                if (data && data.success && data.data) {
                    const table = `
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>City</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.map(user => `
                                    <tr>
                                        <td>${user.id || 'N/A'}</td>
                                        <td>${user.name || 'N/A'}</td>
                                        <td>${user.email || 'N/A'}</td>
                                        <td>${user.city || 'N/A'}</td>
                                        <td>${user.isActive ? 'Active' : 'Inactive'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    container.innerHTML = table;
                } else {
                    container.innerHTML = '<div class="error">No users found</div>';
                }
            } catch (error) {
                container.innerHTML = '<div class="error">Error loading users</div>';
            }
        }

        async function loadTrips() {
            const container = document.getElementById('tripsData');
            container.innerHTML = '<div class="loading">Loading trips...</div>';
            
            try {
                const data = await fetchData('trips');
                if (data && data.success && data.data) {
                    const table = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Trip ID</th>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Duration</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.map(trip => `
                                    <tr>
                                        <td>${trip.id || 'N/A'}</td>
                                        <td>${trip.fromName || trip.from?.name || 'N/A'}</td>
                                        <td>${trip.toName || trip.to?.name || 'N/A'}</td>
                                        <td>${trip.duration || 'N/A'} min</td>
                                        <td>${trip.status || 'N/A'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    container.innerHTML = table;
                } else {
                    container.innerHTML = '<div class="error">No trips found</div>';
                }
            } catch (error) {
                container.innerHTML = '<div class="error">Error loading trips</div>';
            }
        }

        async function loadRoutes() {
            const container = document.getElementById('routesData');
            container.innerHTML = '<div class="loading">Loading routes...</div>';
            
            try {
                const data = await fetchData('routes');
                if (data && data.success && data.data) {
                    const table = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Route ID</th>
                                    <th>Name</th>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Distance</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.map(route => `
                                    <tr>
                                        <td>${route.id || 'N/A'}</td>
                                        <td>${route.name || 'N/A'}</td>
                                        <td>${route.originName || route.origin?.name || 'N/A'}</td>
                                        <td>${route.destinationName || route.destination?.name || 'N/A'}</td>
                                        <td>${route.distance || 'N/A'} km</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    container.innerHTML = table;
                } else {
                    container.innerHTML = '<div class="error">No routes found</div>';
                }
            } catch (error) {
                container.innerHTML = '<div class="error">Error loading routes</div>';
            }
        }

        async function loadEcoStats() {
            const container = document.getElementById('ecoStatsData');
            container.innerHTML = '<div class="loading">Loading eco stats...</div>';
            
            try {
                const data = await fetchData('ecostats');
                if (data && data.success && data.data) {
                    const table = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Period</th>
                                    <th>CO2 Saved</th>
                                    <th>Distance Walked</th>
                                    <th>Eco Score</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.map(stat => `
                                    <tr>
                                        <td>${stat.periodType || 'N/A'}</td>
                                        <td>${stat.co2Saved || 'N/A'} kg</td>
                                        <td>${stat.distanceWalked || 'N/A'} km</td>
                                        <td>${stat.ecoScore || 'N/A'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    container.innerHTML = table;
                } else {
                    container.innerHTML = '<div class="error">No eco stats found</div>';
                }
            } catch (error) {
                container.innerHTML = '<div class="error">Error loading eco stats</div>';
            }
        }

        async function loadNotifications() {
            const container = document.getElementById('notificationsData');
            container.innerHTML = '<div class="loading">Loading notifications...</div>';
            
            try {
                const data = await fetchData('notifications');
                if (data && data.success && data.data) {
                    const table = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Type</th>
                                    <th>Read</th>
                                    <th>Created</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.map(notification => `
                                    <tr>
                                        <td>${notification.title || 'N/A'}</td>
                                        <td>${notification.type || 'N/A'}</td>
                                        <td>${notification.isRead ? 'Yes' : 'No'}</td>
                                        <td>${new Date(notification.createdAt).toLocaleDateString()}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    container.innerHTML = table;
                } else {
                    container.innerHTML = '<div class="error">No notifications found</div>';
                }
            } catch (error) {
                container.innerHTML = '<div class="error">Error loading notifications</div>';
            }
        }

        async function loadTraffic() {
            const container = document.getElementById('trafficData');
            container.innerHTML = '<div class="loading">Loading traffic data...</div>';
            
            try {
                const data = await fetchData('traffic');
                if (data && data.success && data.data) {
                    const table = `
                        <table>
                            <thead>
                                <tr>
                                    <th>Location</th>
                                    <th>Traffic Level</th>
                                    <th>Speed</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.data.map(traffic => `
                                    <tr>
                                        <td>${traffic.locationCity || traffic.location?.city || 'N/A'}</td>
                                        <td>${traffic.trafficLevel || traffic.trafficConditions?.level || 'N/A'}</td>
                                        <td>${traffic.averageSpeed || traffic.currentMetrics?.averageSpeed || 'N/A'} km/h</td>
                                        <td>${traffic.isActive ? 'Active' : 'Inactive'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    container.innerHTML = table;
                } else {
                    container.innerHTML = '<div class="error">No traffic data found</div>';
                }
            } catch (error) {
                container.innerHTML = '<div class="error">Error loading traffic data</div>';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadOverview();
        });
    </script>
</body>
</html>
